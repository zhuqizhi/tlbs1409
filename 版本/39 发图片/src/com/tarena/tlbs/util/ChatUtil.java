package com.tarena.tlbs.util;

import java.io.FileInputStream;

import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.util.Base64;

public class ChatUtil {
	// 定义五种数据类型
	public final static int TYPE_TEXT = 1;
	public final static int TYPE_FACE = 2;
	public final static int TYPE_IMAGE = 3;
	public final static int TYPE_AUDIO = 4;
	public final static int TYPE_MAP = 5;
	// 定义五种数据类型的tag
	public final static String TAG_TEXT = "<!--text>";
	public final static String TAG_FACE = "<!--face>";
	public final static String TAG_IMAGE = "<!--image>";
	public final static String TAG_AUDIO = "<!--audio>";
	public final static String TAG_MAP = "<!--map>";
	public final static String TAG_END = "<!end>";

	/**
	 * 给face加tag
	 * 
	 * @param faceId
	 */
	public static String addFaceTag(int faceId) {
		StringBuilder builder = new StringBuilder();
		builder.append(TAG_FACE);
		builder.append(faceId);
		builder.append(TAG_END);
		return builder.toString();

	}

	/**
	 * 得到数据的类型
	 * 
	 * @param body
	 * @return
	 */
	public static int getType(String body) {
		if (body.startsWith(TAG_FACE)) {
			return TYPE_FACE;
		} else if (body.startsWith(TAG_IMAGE)) {
			return TYPE_IMAGE;
		} else if (body.startsWith(TAG_AUDIO)) {
			return TYPE_AUDIO;
		} else if (body.startsWith(TAG_MAP)) {
			return TYPE_MAP;
		}
		return TYPE_TEXT;
	}

	public static int getFaceId(String body) {
		// body=<!--face>7515</end>
		int start = TAG_FACE.length();
		int end = body.length() - TAG_END.length();
		String strFace = body.substring(start, end);
		return Integer.parseInt(strFace);
	}
	
	/**
	 * 给图片数据加tag
	 * @param imageData
	 * @return body
	 */
	public static String addImageTag
	(byte[] imageData)
	{
		StringBuilder builder=new StringBuilder();
		//因为在网上发送的是xml,xml中只能放String
		//把byte[]转成String 
		//转有两种方法
		//1:适合于发送端和接收端都是android手机
		 //发送端 new String(imageData);
		//接收端 "body".getBytes()得到图的数据
//2：字符编码是android,iphone都支持的，用base64
		//base64 可以把byte[]转成字符串，再把字符串转成byte[]
		//base64编码android,iphone都支持。
		//发送端，你用的手机是android,
		//接收端用的iphone6
		//byte[]-->String <body>string</body>
		String body=Base64.encodeToString(imageData, Base64.DEFAULT);
		builder.append(TAG_IMAGE);
		builder.append(body);
		builder.append(TAG_END);
		
		return builder.toString();
	}
	public static byte[] getSdcardImage()
	{
		String fileName=Const.SDCARD_ROOT+"/1.jpg";
		byte[] data=null;
		try {
			FileInputStream fileInputStream=new FileInputStream(fileName);
			int size=fileInputStream.available();
			data=new byte[size];
			fileInputStream.read(data);
		} catch (Exception e) {
			e.printStackTrace();
		}
		return data;
	}
	
	/**
	 * 收到图片时调用
	 * @param body
	 * @return 图
	 */
	public static Bitmap getImage(String body)
	{
		//<message><body>由图转成的字符串</body></message>
		//去掉tag
		int start=TAG_IMAGE.length();
		int end=body.length()-TAG_END.length();
		body=body.substring(start, end);
		//把字符串用base64解码成byte[]
		byte[] data=Base64.decode(body, Base64.DEFAULT);
		//byte[]-->bitmap
		Bitmap bitmap=BitmapFactory.decodeByteArray(data, 0, data.length);
		return bitmap;
	}
}
